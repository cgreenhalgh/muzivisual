# musivisual data & files

## v2.0

### Compiled into app:

- content page texts in [../app/public/js/menu.js](../app/public/js/menu.js) 
  for 'Programme Note', 'Performer', 'What can see and hear', 'Archive', 'How it works', 'Research'

- links for 'Archive', 'How it works'

- current performance mapTitle, performer, location in [../app/public/js/climb-map.js](../app/public/js/climb-map.js) lines 240-242 (mapCtrl controller on path `/performance')

- map preview mapTitle, performer, location in [../app/public/js/climb-map.js](../app/public/js/climb-map.js) lines 92-94 and 158-160 (pastPerfCtrl controller on path `/performance/past?i=100`)

### past performances

Loaded from server `/allPerformances` by visualMapBuilder in [../app/public/js/climb-map-builder.service.js](../app/public/js/climb-map-builder.service.js) line 19

Comprises an object with key = performance id (e.g. `performance:9333e7a2-16a9-4352-a45a-f6f42d848cde`) and value object with fields:
- `value`: array of JSON-encoded app events - extracted from Redis or musicode log
- `title`: performance title
- `performer`: performance performer name
- `location`: performance location

Generated by [../app/server.js](../app/server.js):
- reads `/public/config/performances.json`
- and `/public/config/performances_metadata.json` 
- merges top-level map values as objects
- copies time out of JSON(values[0]).time

`performances.json` is object with key = performance id (e.g. `performance:9333e7a2-16a9-4352-a45a-f6f42d848cde`) and value object with fields:
- "type": "list",
- "value": array of JSON-encoded app events 

Event examples:
```
`"{\"name\":\"vStart\",\"time\":1496938319255,\"data\":\"be418821-436d-41c2-880c-058dffb57d91:basecamp\"}",
"{\"name\":\"vStageChange\",\"time\":1496938501236,\"data\":\"be418821-436d-41c2-880c-058dffb57d91:basecamp->1a\"}"
```

`performances_metadata.json` is object with key = performance id and value object with fields e.g.
- "title": "June 8 Dress Rehearsal",
- "performer":"Maria Kallionpää",
- "location":"Nottingham",
- "description": "Dress Rehearsal, June 8 2017" - unused?!


### map

Loaded from server `/map` by visualMapBuilder in [../app/public/js/climb-map-builder.service.js](../app/public/js/climb-map-builder.service.js) line 36

Array of stage objects, each with properties:
- `name` - stage title _could add to main spreadsheet_
- `stage` - stage id _key_
- `cue` - '/'-separated list of stage ids _could infer from main spreadsheet_
- `x` - number (0-1) as string _could add to main spreadsheet_
- `y` - number(0-1) as string _could add to main spreadsheet_
- `path` - number (0/1/2/3) as string _could add to main spreadsheet_

Generated by [../app/server.js](../app/server.js) from `/maps/Climb!London.csv`. 

`Climb!London.csv` is CSV file with columns:
- `stage_name` - text name, passed to app as `name`
- `stage` - text ID, passed to app as `stage`
- `cue` - '/'-separated list of stage ids, passed to app as `cue`
- `map_x` - number (0-1), passed to app as `x` (string)
- `map_y` - number(0-1), passed to app as `y` (string)
- `path` - number (0/1/2/3), passed to app as `path` (string)
- `original_x` - number (int), not used
- `original_y` - number, not used
- `oldcue` - cue list (historical information, about older version)
- `futurecue` - cue list (planning information, for possible version with more links)


### narratives

Loaded from server `/fragments/` by visualMapBuilder in [../app/public/js/climb-map-builder.service.js](../app/public/js/climb-map-builder.service.js) line 46

Array of objects with fields:
- `from` - from stage
- `to` - to stage
- `stageChange` - transition, in form "FROM->TO", e.g. "->basecamap", "basecamp->1a"
- `narrative` - text _would need new sheet or file_

Generated by [../app/server.js](../app/server.js) from `/visualcontent/narrativesLondon.csv`

`/visualcontent/narrativesLondon.csv` is called a CSV file, but is actually '/'-separated with columns:
- `from` - stage id (may be ''), passed to app as `from`
- `to` - stage id, passed to app as `to`
- `narrative`- text, passed to app (minus last character) as narrative
